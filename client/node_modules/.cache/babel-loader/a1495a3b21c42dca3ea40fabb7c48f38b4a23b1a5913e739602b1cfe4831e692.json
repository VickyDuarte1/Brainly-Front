{"ast":null,"code":"import { encoder, concat, uint32be, lengthAndInput, concatKdf } from '../lib/buffer_utils.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport async function deriveKey(publicKey, privateKey, algorithm, keyLength) {\n  let apu = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : new Uint8Array(0);\n  let apv = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : new Uint8Array(0);\n  if (!isCryptoKey(publicKey)) {\n    throw new TypeError(invalidKeyInput(publicKey, ...types));\n  }\n  checkEncCryptoKey(publicKey, 'ECDH');\n  if (!isCryptoKey(privateKey)) {\n    throw new TypeError(invalidKeyInput(privateKey, ...types));\n  }\n  checkEncCryptoKey(privateKey, 'ECDH', 'deriveBits');\n  const value = concat(lengthAndInput(encoder.encode(algorithm)), lengthAndInput(apu), lengthAndInput(apv), uint32be(keyLength));\n  let length;\n  if (publicKey.algorithm.name === 'X25519') {\n    length = 256;\n  } else if (publicKey.algorithm.name === 'X448') {\n    length = 448;\n  } else {\n    length = Math.ceil(parseInt(publicKey.algorithm.namedCurve.substr(-3), 10) / 8) << 3;\n  }\n  const sharedSecret = new Uint8Array(await crypto.subtle.deriveBits({\n    name: publicKey.algorithm.name,\n    public: publicKey\n  }, privateKey, length));\n  return concatKdf(sharedSecret, keyLength, value);\n}\nexport async function generateEpk(key) {\n  if (!isCryptoKey(key)) {\n    throw new TypeError(invalidKeyInput(key, ...types));\n  }\n  return crypto.subtle.generateKey(key.algorithm, true, ['deriveBits']);\n}\nexport function ecdhAllowed(key) {\n  if (!isCryptoKey(key)) {\n    throw new TypeError(invalidKeyInput(key, ...types));\n  }\n  return ['P-256', 'P-384', 'P-521'].includes(key.algorithm.namedCurve) || key.algorithm.name === 'X25519' || key.algorithm.name === 'X448';\n}","map":{"version":3,"names":["encoder","concat","uint32be","lengthAndInput","concatKdf","crypto","isCryptoKey","checkEncCryptoKey","invalidKeyInput","types","deriveKey","publicKey","privateKey","algorithm","keyLength","apu","arguments","length","undefined","Uint8Array","apv","TypeError","value","encode","name","Math","ceil","parseInt","namedCurve","substr","sharedSecret","subtle","deriveBits","public","generateEpk","key","generateKey","ecdhAllowed","includes"],"sources":["C:/Users/rama_/Desktop/vicky uni/Henrry Prep Course/otrom2/Brainly-Front/client/node_modules/jose/dist/browser/runtime/ecdhes.js"],"sourcesContent":["import { encoder, concat, uint32be, lengthAndInput, concatKdf } from '../lib/buffer_utils.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport async function deriveKey(publicKey, privateKey, algorithm, keyLength, apu = new Uint8Array(0), apv = new Uint8Array(0)) {\n    if (!isCryptoKey(publicKey)) {\n        throw new TypeError(invalidKeyInput(publicKey, ...types));\n    }\n    checkEncCryptoKey(publicKey, 'ECDH');\n    if (!isCryptoKey(privateKey)) {\n        throw new TypeError(invalidKeyInput(privateKey, ...types));\n    }\n    checkEncCryptoKey(privateKey, 'ECDH', 'deriveBits');\n    const value = concat(lengthAndInput(encoder.encode(algorithm)), lengthAndInput(apu), lengthAndInput(apv), uint32be(keyLength));\n    let length;\n    if (publicKey.algorithm.name === 'X25519') {\n        length = 256;\n    }\n    else if (publicKey.algorithm.name === 'X448') {\n        length = 448;\n    }\n    else {\n        length =\n            Math.ceil(parseInt(publicKey.algorithm.namedCurve.substr(-3), 10) / 8) << 3;\n    }\n    const sharedSecret = new Uint8Array(await crypto.subtle.deriveBits({\n        name: publicKey.algorithm.name,\n        public: publicKey,\n    }, privateKey, length));\n    return concatKdf(sharedSecret, keyLength, value);\n}\nexport async function generateEpk(key) {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return crypto.subtle.generateKey(key.algorithm, true, ['deriveBits']);\n}\nexport function ecdhAllowed(key) {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return (['P-256', 'P-384', 'P-521'].includes(key.algorithm.namedCurve) ||\n        key.algorithm.name === 'X25519' ||\n        key.algorithm.name === 'X448');\n}\n"],"mappings":"AAAA,SAASA,OAAO,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,SAAS,QAAQ,wBAAwB;AAC7F,OAAOC,MAAM,IAAIC,WAAW,QAAQ,gBAAgB;AACpD,SAASC,iBAAiB,QAAQ,sBAAsB;AACxD,OAAOC,eAAe,MAAM,6BAA6B;AACzD,SAASC,KAAK,QAAQ,kBAAkB;AACxC,OAAO,eAAeC,SAASA,CAACC,SAAS,EAAEC,UAAU,EAAEC,SAAS,EAAEC,SAAS,EAAoD;EAAA,IAAlDC,GAAG,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAIG,UAAU,CAAC,CAAC,CAAC;EAAA,IAAEC,GAAG,GAAAJ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAIG,UAAU,CAAC,CAAC,CAAC;EACzH,IAAI,CAACb,WAAW,CAACK,SAAS,CAAC,EAAE;IACzB,MAAM,IAAIU,SAAS,CAACb,eAAe,CAACG,SAAS,EAAE,GAAGF,KAAK,CAAC,CAAC;EAC7D;EACAF,iBAAiB,CAACI,SAAS,EAAE,MAAM,CAAC;EACpC,IAAI,CAACL,WAAW,CAACM,UAAU,CAAC,EAAE;IAC1B,MAAM,IAAIS,SAAS,CAACb,eAAe,CAACI,UAAU,EAAE,GAAGH,KAAK,CAAC,CAAC;EAC9D;EACAF,iBAAiB,CAACK,UAAU,EAAE,MAAM,EAAE,YAAY,CAAC;EACnD,MAAMU,KAAK,GAAGrB,MAAM,CAACE,cAAc,CAACH,OAAO,CAACuB,MAAM,CAACV,SAAS,CAAC,CAAC,EAAEV,cAAc,CAACY,GAAG,CAAC,EAAEZ,cAAc,CAACiB,GAAG,CAAC,EAAElB,QAAQ,CAACY,SAAS,CAAC,CAAC;EAC9H,IAAIG,MAAM;EACV,IAAIN,SAAS,CAACE,SAAS,CAACW,IAAI,KAAK,QAAQ,EAAE;IACvCP,MAAM,GAAG,GAAG;EAChB,CAAC,MACI,IAAIN,SAAS,CAACE,SAAS,CAACW,IAAI,KAAK,MAAM,EAAE;IAC1CP,MAAM,GAAG,GAAG;EAChB,CAAC,MACI;IACDA,MAAM,GACFQ,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAChB,SAAS,CAACE,SAAS,CAACe,UAAU,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;EACnF;EACA,MAAMC,YAAY,GAAG,IAAIX,UAAU,CAAC,MAAMd,MAAM,CAAC0B,MAAM,CAACC,UAAU,CAAC;IAC/DR,IAAI,EAAEb,SAAS,CAACE,SAAS,CAACW,IAAI;IAC9BS,MAAM,EAAEtB;EACZ,CAAC,EAAEC,UAAU,EAAEK,MAAM,CAAC,CAAC;EACvB,OAAOb,SAAS,CAAC0B,YAAY,EAAEhB,SAAS,EAAEQ,KAAK,CAAC;AACpD;AACA,OAAO,eAAeY,WAAWA,CAACC,GAAG,EAAE;EACnC,IAAI,CAAC7B,WAAW,CAAC6B,GAAG,CAAC,EAAE;IACnB,MAAM,IAAId,SAAS,CAACb,eAAe,CAAC2B,GAAG,EAAE,GAAG1B,KAAK,CAAC,CAAC;EACvD;EACA,OAAOJ,MAAM,CAAC0B,MAAM,CAACK,WAAW,CAACD,GAAG,CAACtB,SAAS,EAAE,IAAI,EAAE,CAAC,YAAY,CAAC,CAAC;AACzE;AACA,OAAO,SAASwB,WAAWA,CAACF,GAAG,EAAE;EAC7B,IAAI,CAAC7B,WAAW,CAAC6B,GAAG,CAAC,EAAE;IACnB,MAAM,IAAId,SAAS,CAACb,eAAe,CAAC2B,GAAG,EAAE,GAAG1B,KAAK,CAAC,CAAC;EACvD;EACA,OAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC6B,QAAQ,CAACH,GAAG,CAACtB,SAAS,CAACe,UAAU,CAAC,IAClEO,GAAG,CAACtB,SAAS,CAACW,IAAI,KAAK,QAAQ,IAC/BW,GAAG,CAACtB,SAAS,CAACW,IAAI,KAAK,MAAM;AACrC"},"metadata":{},"sourceType":"module","externalDependencies":[]}