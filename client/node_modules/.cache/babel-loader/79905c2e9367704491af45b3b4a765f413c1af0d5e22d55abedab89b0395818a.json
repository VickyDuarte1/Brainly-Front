{"ast":null,"code":"import { FlattenedSign } from '../flattened/sign.js';\nimport { JWSInvalid } from '../../util/errors.js';\nclass IndividualSignature {\n  constructor(sig, key, options) {\n    this.parent = sig;\n    this.key = key;\n    this.options = options;\n  }\n  setProtectedHeader(protectedHeader) {\n    if (this.protectedHeader) {\n      throw new TypeError('setProtectedHeader can only be called once');\n    }\n    this.protectedHeader = protectedHeader;\n    return this;\n  }\n  setUnprotectedHeader(unprotectedHeader) {\n    if (this.unprotectedHeader) {\n      throw new TypeError('setUnprotectedHeader can only be called once');\n    }\n    this.unprotectedHeader = unprotectedHeader;\n    return this;\n  }\n  addSignature() {\n    return this.parent.addSignature(...arguments);\n  }\n  sign() {\n    return this.parent.sign(...arguments);\n  }\n  done() {\n    return this.parent;\n  }\n}\nexport class GeneralSign {\n  constructor(payload) {\n    this._signatures = [];\n    this._payload = payload;\n  }\n  addSignature(key, options) {\n    const signature = new IndividualSignature(this, key, options);\n    this._signatures.push(signature);\n    return signature;\n  }\n  async sign() {\n    if (!this._signatures.length) {\n      throw new JWSInvalid('at least one signature must be added');\n    }\n    const jws = {\n      signatures: [],\n      payload: ''\n    };\n    for (let i = 0; i < this._signatures.length; i++) {\n      const signature = this._signatures[i];\n      const flattened = new FlattenedSign(this._payload);\n      flattened.setProtectedHeader(signature.protectedHeader);\n      flattened.setUnprotectedHeader(signature.unprotectedHeader);\n      const {\n        payload,\n        ...rest\n      } = await flattened.sign(signature.key, signature.options);\n      if (i === 0) {\n        jws.payload = payload;\n      } else if (jws.payload !== payload) {\n        throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\n      }\n      jws.signatures.push(rest);\n    }\n    return jws;\n  }\n}","map":{"version":3,"names":["FlattenedSign","JWSInvalid","IndividualSignature","constructor","sig","key","options","parent","setProtectedHeader","protectedHeader","TypeError","setUnprotectedHeader","unprotectedHeader","addSignature","arguments","sign","done","GeneralSign","payload","_signatures","_payload","signature","push","length","jws","signatures","i","flattened","rest"],"sources":["C:/Users/rama_/Desktop/vicky uni/Henrry Prep Course/otrom2/Brainly-Front/client/node_modules/jose/dist/browser/jws/general/sign.js"],"sourcesContent":["import { FlattenedSign } from '../flattened/sign.js';\nimport { JWSInvalid } from '../../util/errors.js';\nclass IndividualSignature {\n    constructor(sig, key, options) {\n        this.parent = sig;\n        this.key = key;\n        this.options = options;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this.protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this.protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this.unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this.unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    addSignature(...args) {\n        return this.parent.addSignature(...args);\n    }\n    sign(...args) {\n        return this.parent.sign(...args);\n    }\n    done() {\n        return this.parent;\n    }\n}\nexport class GeneralSign {\n    constructor(payload) {\n        this._signatures = [];\n        this._payload = payload;\n    }\n    addSignature(key, options) {\n        const signature = new IndividualSignature(this, key, options);\n        this._signatures.push(signature);\n        return signature;\n    }\n    async sign() {\n        if (!this._signatures.length) {\n            throw new JWSInvalid('at least one signature must be added');\n        }\n        const jws = {\n            signatures: [],\n            payload: '',\n        };\n        for (let i = 0; i < this._signatures.length; i++) {\n            const signature = this._signatures[i];\n            const flattened = new FlattenedSign(this._payload);\n            flattened.setProtectedHeader(signature.protectedHeader);\n            flattened.setUnprotectedHeader(signature.unprotectedHeader);\n            const { payload, ...rest } = await flattened.sign(signature.key, signature.options);\n            if (i === 0) {\n                jws.payload = payload;\n            }\n            else if (jws.payload !== payload) {\n                throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\n            }\n            jws.signatures.push(rest);\n        }\n        return jws;\n    }\n}\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,sBAAsB;AACpD,SAASC,UAAU,QAAQ,sBAAsB;AACjD,MAAMC,mBAAmB,CAAC;EACtBC,WAAWA,CAACC,GAAG,EAAEC,GAAG,EAAEC,OAAO,EAAE;IAC3B,IAAI,CAACC,MAAM,GAAGH,GAAG;IACjB,IAAI,CAACC,GAAG,GAAGA,GAAG;IACd,IAAI,CAACC,OAAO,GAAGA,OAAO;EAC1B;EACAE,kBAAkBA,CAACC,eAAe,EAAE;IAChC,IAAI,IAAI,CAACA,eAAe,EAAE;MACtB,MAAM,IAAIC,SAAS,CAAC,4CAA4C,CAAC;IACrE;IACA,IAAI,CAACD,eAAe,GAAGA,eAAe;IACtC,OAAO,IAAI;EACf;EACAE,oBAAoBA,CAACC,iBAAiB,EAAE;IACpC,IAAI,IAAI,CAACA,iBAAiB,EAAE;MACxB,MAAM,IAAIF,SAAS,CAAC,8CAA8C,CAAC;IACvE;IACA,IAAI,CAACE,iBAAiB,GAAGA,iBAAiB;IAC1C,OAAO,IAAI;EACf;EACAC,YAAYA,CAAA,EAAU;IAClB,OAAO,IAAI,CAACN,MAAM,CAACM,YAAY,CAAC,GAAAC,SAAO,CAAC;EAC5C;EACAC,IAAIA,CAAA,EAAU;IACV,OAAO,IAAI,CAACR,MAAM,CAACQ,IAAI,CAAC,GAAAD,SAAO,CAAC;EACpC;EACAE,IAAIA,CAAA,EAAG;IACH,OAAO,IAAI,CAACT,MAAM;EACtB;AACJ;AACA,OAAO,MAAMU,WAAW,CAAC;EACrBd,WAAWA,CAACe,OAAO,EAAE;IACjB,IAAI,CAACC,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,QAAQ,GAAGF,OAAO;EAC3B;EACAL,YAAYA,CAACR,GAAG,EAAEC,OAAO,EAAE;IACvB,MAAMe,SAAS,GAAG,IAAInB,mBAAmB,CAAC,IAAI,EAAEG,GAAG,EAAEC,OAAO,CAAC;IAC7D,IAAI,CAACa,WAAW,CAACG,IAAI,CAACD,SAAS,CAAC;IAChC,OAAOA,SAAS;EACpB;EACA,MAAMN,IAAIA,CAAA,EAAG;IACT,IAAI,CAAC,IAAI,CAACI,WAAW,CAACI,MAAM,EAAE;MAC1B,MAAM,IAAItB,UAAU,CAAC,sCAAsC,CAAC;IAChE;IACA,MAAMuB,GAAG,GAAG;MACRC,UAAU,EAAE,EAAE;MACdP,OAAO,EAAE;IACb,CAAC;IACD,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACP,WAAW,CAACI,MAAM,EAAEG,CAAC,EAAE,EAAE;MAC9C,MAAML,SAAS,GAAG,IAAI,CAACF,WAAW,CAACO,CAAC,CAAC;MACrC,MAAMC,SAAS,GAAG,IAAI3B,aAAa,CAAC,IAAI,CAACoB,QAAQ,CAAC;MAClDO,SAAS,CAACnB,kBAAkB,CAACa,SAAS,CAACZ,eAAe,CAAC;MACvDkB,SAAS,CAAChB,oBAAoB,CAACU,SAAS,CAACT,iBAAiB,CAAC;MAC3D,MAAM;QAAEM,OAAO;QAAE,GAAGU;MAAK,CAAC,GAAG,MAAMD,SAAS,CAACZ,IAAI,CAACM,SAAS,CAAChB,GAAG,EAAEgB,SAAS,CAACf,OAAO,CAAC;MACnF,IAAIoB,CAAC,KAAK,CAAC,EAAE;QACTF,GAAG,CAACN,OAAO,GAAGA,OAAO;MACzB,CAAC,MACI,IAAIM,GAAG,CAACN,OAAO,KAAKA,OAAO,EAAE;QAC9B,MAAM,IAAIjB,UAAU,CAAC,4DAA4D,CAAC;MACtF;MACAuB,GAAG,CAACC,UAAU,CAACH,IAAI,CAACM,IAAI,CAAC;IAC7B;IACA,OAAOJ,GAAG;EACd;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}