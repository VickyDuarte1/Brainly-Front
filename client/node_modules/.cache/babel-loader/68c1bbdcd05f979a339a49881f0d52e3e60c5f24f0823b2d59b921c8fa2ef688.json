{"ast":null,"code":"import fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nclass RemoteJWKSet extends LocalJWKSet {\n  constructor(url, options) {\n    super({\n      keys: []\n    });\n    this._jwks = undefined;\n    if (!(url instanceof URL)) {\n      throw new TypeError('url must be an instance of URL');\n    }\n    this._url = new URL(url.href);\n    this._options = {\n      agent: options === null || options === void 0 ? void 0 : options.agent,\n      headers: options === null || options === void 0 ? void 0 : options.headers\n    };\n    this._timeoutDuration = typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n    this._cooldownDuration = typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n    this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n  }\n  coolingDown() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cooldownDuration : false;\n  }\n  fresh() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cacheMaxAge : false;\n  }\n  async getKey(protectedHeader, token) {\n    if (!this._jwks || !this.fresh()) {\n      await this.reload();\n    }\n    try {\n      return await super.getKey(protectedHeader, token);\n    } catch (err) {\n      if (err instanceof JWKSNoMatchingKey) {\n        if (this.coolingDown() === false) {\n          await this.reload();\n          return super.getKey(protectedHeader, token);\n        }\n      }\n      throw err;\n    }\n  }\n  async reload() {\n    if (this._pendingFetch && isCloudflareWorkers()) {\n      this._pendingFetch = undefined;\n    }\n    this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options).then(json => {\n      if (!isJWKSLike(json)) {\n        throw new JWKSInvalid('JSON Web Key Set malformed');\n      }\n      this._jwks = {\n        keys: json.keys\n      };\n      this._jwksTimestamp = Date.now();\n      this._pendingFetch = undefined;\n    }).catch(err => {\n      this._pendingFetch = undefined;\n      throw err;\n    }));\n    await this._pendingFetch;\n  }\n}\nexport function createRemoteJWKSet(url, options) {\n  const set = new RemoteJWKSet(url, options);\n  return async function (protectedHeader, token) {\n    return set.getKey(protectedHeader, token);\n  };\n}","map":{"version":3,"names":["fetchJwks","isCloudflareWorkers","JWKSInvalid","JWKSNoMatchingKey","isJWKSLike","LocalJWKSet","RemoteJWKSet","constructor","url","options","keys","_jwks","undefined","URL","TypeError","_url","href","_options","agent","headers","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","cacheMaxAge","coolingDown","_jwksTimestamp","Date","now","fresh","getKey","protectedHeader","token","reload","err","_pendingFetch","then","json","catch","createRemoteJWKSet","set"],"sources":["C:/Users/rama_/Desktop/vicky uni/Henrry Prep Course/otrom2/Brainly-Front/client/node_modules/jose/dist/browser/jwks/remote.js"],"sourcesContent":["import fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nclass RemoteJWKSet extends LocalJWKSet {\n    constructor(url, options) {\n        super({ keys: [] });\n        this._jwks = undefined;\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options === null || options === void 0 ? void 0 : options.agent, headers: options === null || options === void 0 ? void 0 : options.headers };\n        this._timeoutDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._jwks || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await super.getKey(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return super.getKey(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            if (!isJWKSLike(json)) {\n                throw new JWKSInvalid('JSON Web Key Set malformed');\n            }\n            this._jwks = { keys: json.keys };\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    return async function (protectedHeader, token) {\n        return set.getKey(protectedHeader, token);\n    };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}